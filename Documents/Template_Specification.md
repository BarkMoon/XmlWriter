# テンプレート仕様書

本ツールで使用可能なテンプレートファイルの記述仕様について解説します。

## 1. 変数置換
Excelのデータをテンプレート内に埋め込むための記法です。

*   **`${列ヘッダ名}`**: データ行の対応するセルの値に置換されます。
    *   例: `${Id}`, `${Name}`, `${Properties.Suit}`
    *   `Properties.Suit` のようにドット区切りのヘッダもそのまま記述可能です。

*   **`@TableName`**: 対象のテーブル名（シート名）に置換されます。
*   **`@GeneratedDate`**: 生成日時（`yyyy/MM/dd HH:mm:ss`）に置換されます。

## 2. 制御マクロ
コードの生成フローを制御するための構文です。

### 全行ループ
**`#ForAllData` ～ `#EndForAllData`**
Excelの有効なデータ行の数だけ、ブロック内の記述を繰り返します。
各反復において、`${...}` の変数置換が行われます。

### データ条件分岐
**`#If(条件式)` ～ `#Elif(条件式)` ～ `#Else` ～ `#Endif`**
条件式の結果に応じて、ブロック内の出力を制御します。
*   `#ForAllData` ループ内で使用した場合、行ごとのデータに応じて動的に判定されます。
*   インデントされた `#If` ブロックは、条件適合時にインデントを維持して展開されます（不要な空白は除去されます）。

**使用可能な関数マクロ (条件式用):**
*   **`#Eq(A, B)`**: AとBが等しい場合 `True`
*   **`#Not(A)`**: Aが `True` なら `False` (否定)
*   **`#And(A, B, ...)`**: 全て `True` なら `True`
*   **`#Or(A, B, ...)`**: いずれかが `True` なら `True`
*   **`#Contains(A, B)`**: AがBを含む場合 `True`

### 重複行削除
**`#EraseDuplicatedLine` ～ `#EndErase`**
ブロック内に含まれる行のうち、重複している行を削除します。
*   **最初の1回目**に出現した行は残ります。2回目以降の同一行は除去されます。
*   判定は**行単位**で行われ（前後の空白を含む）、完全に一致する場合に削除されます。
*   `using` 句の整理や、ループ展開によって生じた重複定義の排除に利用できます。

## 3. 処理の実行順序
テンプレート処理は以下の順序で実行されます。記述の際の参考にしてください。

1.  **データ展開 (`#ForAllData`)**:
    *   行ごとの変数が値に置換されます。
    *   ループ内で使用されている `#If` などの条件分岐もこの時点で評価・確定されます。
2.  **グローバル変数置換**:
    *   `@TableName`, `@GeneratedDate` が置換されます。
3.  **最終条件分岐**:
    *   ループ外にある `#If` などが評価されます。
4.  **重複行削除 (`#EraseDuplicatedLine`)**:
    *   全ての展開が完了したコードに対して、重複行の削除処理が適用されます。
    *   これにより、ループ展開後に生じた意図しない重複もクリーンアップできます。
